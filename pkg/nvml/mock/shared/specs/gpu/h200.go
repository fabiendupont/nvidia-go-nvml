/*
 * Copyright (c) 2025, NVIDIA CORPORATION.  All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package gpu

import (
	"github.com/NVIDIA/go-nvml/pkg/nvml"
	"github.com/NVIDIA/go-nvml/pkg/nvml/mock/shared"
)

// H200Spec defines the GPU specification for NVIDIA H200-SXM5-141GB
var H200Spec = shared.GPUSpec{
	Name:                "NVIDIA H200 141GB HBM3e",
	Architecture:        nvml.DEVICE_ARCH_HOPPER,
	Brand:               nvml.BRAND_TESLA,
	PciDeviceId:         shared.H200_PCI_DEVICE_ID,
	PciBusIDBase:        "0000:4b:%02x:00.0", // H200 uses bus 0x4b:0x00-0x07
	DriverVersion:       shared.DEFAULT_DRIVER_VERSION,
	NvmlVersion:         shared.DEFAULT_NVML_VERSION,
	CudaDriverVersion:   shared.DEFAULT_CUDA_DRIVER_VERSION,
	CudaCapabilityMajor: shared.H200_CUDA_MAJOR,
	CudaCapabilityMinor: shared.H200_CUDA_MINOR,
	TotalMemoryMB:       shared.H200_TOTAL_MEMORY_MB,
	MIGProfiles:         H200MIGProfiles,
}

// H200MIGProfiles defines the complete MIG profile configuration for H200
var H200MIGProfiles = shared.MIGProfileConfig{
	GpuInstanceProfiles: map[int]nvml.GpuInstanceProfileInfo{
		// Base slice profiles
		nvml.GPU_INSTANCE_PROFILE_1_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_1_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          1,
			InstanceCount:       shared.MIG_1_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_1_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_1_SLICE_CE_COUNT,
			DecoderCount:        1,
			EncoderCount:        0,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_1G_18GB_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_2_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          2,
			InstanceCount:       shared.MIG_2_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_2_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_2_SLICE_CE_COUNT,
			DecoderCount:        2,
			EncoderCount:        1,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_2G_35GB_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_3_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_3_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          3,
			InstanceCount:       shared.MIG_3_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_3_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_3_SLICE_CE_COUNT,
			DecoderCount:        3,
			EncoderCount:        2,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_3G_71GB_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_4_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_4_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          4,
			InstanceCount:       shared.MIG_4_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_4_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_4_SLICE_CE_COUNT,
			DecoderCount:        4,
			EncoderCount:        3,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_4G_71GB_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_6_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_6_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          6,
			InstanceCount:       1,
			MultiprocessorCount: shared.H200_MIG_6_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_6_SLICE_CE_COUNT,
			DecoderCount:        6,
			EncoderCount:        5,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_6G_106GB_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_7_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_7_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          7,
			InstanceCount:       shared.MIG_7_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_7_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_7_SLICE_CE_COUNT,
			DecoderCount:        7,
			EncoderCount:        7,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_7G_141GB_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_8_SLICE: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_8_SLICE,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          8,
			InstanceCount:       1,
			MultiprocessorCount: shared.H200_MIG_8_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_8_SLICE_CE_COUNT,
			DecoderCount:        8,
			EncoderCount:        7,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_8G_141GB_MEMORY_MB,
		},
		// Revision variants
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV1: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV1,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          1,
			InstanceCount:       1,
			MultiprocessorCount: shared.H200_MIG_1_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_1_SLICE_CE_COUNT,
			DecoderCount:        1,
			EncoderCount:        0,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_1G_REV1_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_REV1: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_2_SLICE_REV1,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          2,
			InstanceCount:       2,
			MultiprocessorCount: shared.H200_MIG_2_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_2_SLICE_CE_COUNT,
			DecoderCount:        2,
			EncoderCount:        1,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_2G_REV1_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV2: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV2,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          1,
			InstanceCount:       4,
			MultiprocessorCount: shared.H200_MIG_1_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_1_SLICE_CE_COUNT,
			DecoderCount:        1,
			EncoderCount:        0,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_1G_REV2_MEMORY_MB,
		},
		// Graphics variants
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_GFX: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_1_SLICE_GFX,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          1,
			InstanceCount:       shared.MIG_1_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_1_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_1_SLICE_CE_COUNT,
			DecoderCount:        1,
			EncoderCount:        1,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_1G_GFX_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_GFX: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_2_SLICE_GFX,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          2,
			InstanceCount:       shared.MIG_2_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_2_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_2_SLICE_CE_COUNT,
			DecoderCount:        2,
			EncoderCount:        2,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_2G_GFX_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_4_SLICE_GFX: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_4_SLICE_GFX,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          4,
			InstanceCount:       shared.MIG_4_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_4_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_4_SLICE_CE_COUNT,
			DecoderCount:        4,
			EncoderCount:        4,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_4G_GFX_MEMORY_MB,
		},
		// Memory engine variants
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_NO_ME: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_1_SLICE_NO_ME,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          1,
			InstanceCount:       shared.MIG_1_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_1_SLICE_SM_COUNT,
			CopyEngineCount:     0, // No memory engines
			DecoderCount:        0,
			EncoderCount:        0,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_1G_NO_ME_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_NO_ME: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_2_SLICE_NO_ME,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          2,
			InstanceCount:       shared.MIG_2_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_2_SLICE_SM_COUNT,
			CopyEngineCount:     0, // No memory engines
			DecoderCount:        0,
			EncoderCount:        0,
			JpegCount:           0,
			OfaCount:            0,
			MemorySizeMB:        shared.H200_MIG_2G_NO_ME_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_ALL_ME: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_1_SLICE_ALL_ME,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          1,
			InstanceCount:       shared.MIG_1_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_1_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_1_SLICE_CE_COUNT * 2, // All memory engines
			DecoderCount:        2,
			EncoderCount:        2,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_1G_ALL_ME_MEMORY_MB,
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_ALL_ME: {
			Id:                  nvml.GPU_INSTANCE_PROFILE_2_SLICE_ALL_ME,
			IsP2pSupported:      shared.H200_MIG_P2P_SUPPORT,
			SliceCount:          2,
			InstanceCount:       shared.MIG_2_SLICE_INSTANCE_COUNT,
			MultiprocessorCount: shared.H200_MIG_2_SLICE_SM_COUNT,
			CopyEngineCount:     shared.H200_MIG_2_SLICE_CE_COUNT * 2, // All memory engines
			DecoderCount:        4,
			EncoderCount:        4,
			JpegCount:           1,
			OfaCount:            1,
			MemorySizeMB:        shared.H200_MIG_2G_ALL_ME_MEMORY_MB,
		},
	},
	ComputeInstanceProfiles: map[int]map[int]nvml.ComputeInstanceProfileInfo{
		// Base slice profiles
		nvml.GPU_INSTANCE_PROFILE_1_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         2,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
			nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE,
				SliceCount:            2,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_2_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_2_SLICE_CE_COUNT,
				SharedDecoderCount:    2,
				SharedEncoderCount:    1,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_3_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         3,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
			nvml.COMPUTE_INSTANCE_PROFILE_3_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_3_SLICE,
				SliceCount:            3,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_3_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_3_SLICE_CE_COUNT,
				SharedDecoderCount:    3,
				SharedEncoderCount:    2,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_4_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         4,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
			nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE,
				SliceCount:            2,
				InstanceCount:         2,
				MultiprocessorCount:   shared.H200_MIG_2_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_2_SLICE_CE_COUNT,
				SharedDecoderCount:    2,
				SharedEncoderCount:    1,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
			nvml.COMPUTE_INSTANCE_PROFILE_4_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_4_SLICE,
				SliceCount:            4,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_4_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_4_SLICE_CE_COUNT,
				SharedDecoderCount:    4,
				SharedEncoderCount:    3,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_6_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_6_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_6_SLICE,
				SliceCount:            6,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_6_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_6_SLICE_CE_COUNT,
				SharedDecoderCount:    6,
				SharedEncoderCount:    5,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_7_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_7_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_7_SLICE,
				SliceCount:            7,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_7_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_7_SLICE_CE_COUNT,
				SharedDecoderCount:    7,
				SharedEncoderCount:    7,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_8_SLICE: {
			nvml.COMPUTE_INSTANCE_PROFILE_8_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_8_SLICE,
				SliceCount:            8,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_8_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_8_SLICE_CE_COUNT,
				SharedDecoderCount:    8,
				SharedEncoderCount:    7,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		// Revision variants
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV1: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE_REV1: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE_REV1,
				SliceCount:            1,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    0,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_REV1: {
			nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE,
				SliceCount:            2,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_2_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_2_SLICE_CE_COUNT,
				SharedDecoderCount:    2,
				SharedEncoderCount:    1,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV2: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         4,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		// Graphics variants
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_GFX: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT,
				SharedDecoderCount:    1,
				SharedEncoderCount:    1,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_GFX: {
			nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE,
				SliceCount:            2,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_2_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_2_SLICE_CE_COUNT,
				SharedDecoderCount:    2,
				SharedEncoderCount:    2,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_4_SLICE_GFX: {
			nvml.COMPUTE_INSTANCE_PROFILE_4_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_4_SLICE,
				SliceCount:            4,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_4_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_4_SLICE_CE_COUNT,
				SharedDecoderCount:    4,
				SharedEncoderCount:    4,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		// Memory engine variants
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_NO_ME: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: 0, // No memory engines
				SharedDecoderCount:    0,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_NO_ME: {
			nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE,
				SliceCount:            2,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_2_SLICE_SM_COUNT,
				SharedCopyEngineCount: 0, // No memory engines
				SharedDecoderCount:    0,
				SharedEncoderCount:    0,
				SharedJpegCount:       0,
				SharedOfaCount:        0,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_ALL_ME: {
			nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_1_SLICE,
				SliceCount:            1,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_1_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_1_SLICE_CE_COUNT * 2, // All memory engines
				SharedDecoderCount:    2,
				SharedEncoderCount:    2,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_ALL_ME: {
			nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE: {
				Id:                    nvml.COMPUTE_INSTANCE_PROFILE_2_SLICE,
				SliceCount:            2,
				InstanceCount:         1,
				MultiprocessorCount:   shared.H200_MIG_2_SLICE_SM_COUNT,
				SharedCopyEngineCount: shared.H200_MIG_2_SLICE_CE_COUNT * 2, // All memory engines
				SharedDecoderCount:    4,
				SharedEncoderCount:    4,
				SharedJpegCount:       1,
				SharedOfaCount:        1,
			},
		},
	},
	GpuInstancePlacements: map[int][]nvml.GpuInstancePlacement{
		// 1-slice profiles (all variants)
		nvml.GPU_INSTANCE_PROFILE_1_SLICE: {
			{Start: 0, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 1, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 3, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 5, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 6, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV1: {
			{Start: 0, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 1, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 3, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 5, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 6, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_REV2: {
			{Start: 0, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 1, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 3, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 5, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 6, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_GFX: {
			{Start: 0, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 1, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 3, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 5, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 6, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_NO_ME: {
			{Start: 0, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 1, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 3, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 5, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 6, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_1_SLICE_ALL_ME: {
			{Start: 0, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 1, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 3, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 5, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
			{Start: 6, Size: shared.MIG_1_SLICE_PLACEMENT_SIZE},
		},
		// 2-slice profiles (all variants)
		nvml.GPU_INSTANCE_PROFILE_2_SLICE: {
			{Start: 0, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_REV1: {
			{Start: 0, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_GFX: {
			{Start: 0, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_NO_ME: {
			{Start: 0, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_2_SLICE_ALL_ME: {
			{Start: 0, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 2, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_2_SLICE_PLACEMENT_SIZE},
		},
		// Multi-slice profiles
		nvml.GPU_INSTANCE_PROFILE_3_SLICE: {
			{Start: 0, Size: shared.MIG_3_SLICE_PLACEMENT_SIZE},
			{Start: 4, Size: shared.MIG_3_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_4_SLICE: {
			{Start: 0, Size: shared.MIG_4_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_4_SLICE_GFX: {
			{Start: 0, Size: shared.MIG_4_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_6_SLICE: {
			{Start: 0, Size: 6},
		},
		nvml.GPU_INSTANCE_PROFILE_7_SLICE: {
			{Start: 0, Size: shared.MIG_7_SLICE_PLACEMENT_SIZE},
		},
		nvml.GPU_INSTANCE_PROFILE_8_SLICE: {
			{Start: 0, Size: 8},
		},
	},
	ComputeInstancePlacements: map[int]map[int][]nvml.ComputeInstancePlacement{},
}
